<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Memory Game</title>
    <!-- Removed Tailwind CDN for offline compatibility -->
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <!-- Removed confetti CDN for full offline support -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script> -->
    <style>
        /* Custom CSS replacing Tailwind */
        body {
            background: linear-gradient(to bottom right, #fef3c7, #fbcfe8);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 1rem; /* sm:p-4 equivalent */
            margin: 0;
            font-family: Arial, sans-serif;
        }
        main {
            text-align: center;
            max-width: 64rem; /* max-w-4xl */
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            font-size: 2rem; /* text-2xl */
            font-weight: bold;
            margin-bottom: 1rem; /* mb-4 */
        }
        @media (min-width: 640px) {
            h1 { font-size: 2.25rem; margin-bottom: 2rem; } /* sm:text-4xl sm:mb-8 */
        }
        .stats {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0.5rem; /* space-y-2 */
            margin-bottom: 1rem; /* mb-4 */
            font-size: 0.875rem; /* text-sm */
        }
        @media (min-width: 640px) {
            .stats {
                flex-direction: row;
                gap: 0;
                margin-bottom: 1rem;
                font-size: 1rem; /* sm:text-base */
            }
        }
        .stat {
            font-size: 0.75rem; /* text-xs */
        }
        @media (min-width: 640px) {
            .stat { font-size: 0.875rem; } /* sm:text-sm */
        }
        .stats select {
            padding: 0.5rem 0.75rem; /* px-3 py-2 */
            border: 1px solid #d1d5db; /* border */
            border-radius: 0.375rem; /* rounded */
            font-size: 1rem; /* text-base */
            width: 6rem; /* w-24 */
        }
        #loading {
            display: none;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem; /* mb-4 */
        }
        .spinner {
            animation: spin 1s linear infinite;
            border-radius: 50%;
            height: 2rem;
            width: 2rem;
            border-bottom: 2px solid #f97316; /* border-b-2 border-orange-500 */
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .game-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem; /* mb-4 */
        }
        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* grid-cols-4 */
            gap: 0; /* gap-0 */
            justify-items: center;
            place-items: center;
            max-width: 16rem; /* max-w-64 */
        }
        /* For medium/hard, gap-1 will be set dynamically in JS */
        .card {
            perspective: 1000px;
            background-color: white; /* bg-white */
            border-radius: 0.375rem; /* rounded */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* shadow-md */
            transition: all 0.3s; /* transition-all duration-300 */
            transform: scale(1);
            cursor: pointer;
            justify-self: center;
            width: 4rem;
            height: 4rem; /* w-16 h-16 */
            font-size: 1.875rem; /* text-3xl */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        @media (min-width: 640px) {
            .card { width: 4.5rem; height: 4.5rem; font-size: 2.25rem; } /* sm:w-18 sm:h-18 sm:text-4xl */
        }
        @media (min-width: 768px) {
            .card { width: 5rem; height: 5rem; font-size: 3rem; } /* md:w-20 md:h-20 md:text-5xl */
        }
        @media (min-width: 1024px) {
            .card { width: 6rem; height: 6rem; font-size: 3.75rem; } /* lg:w-24 lg:h-24 lg:text-6xl */
        }
        @media (min-width: 1280px) {
            .card { width: 7rem; height: 7rem; font-size: 4.5rem; } /* xl:w-28 xl:h-28 xl:text-7xl */
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); /* hover:shadow-lg */
            transform: scale(1.05); /* hover:scale-105 */
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem; /* rounded-lg */
        }
        .card-front {
            background: linear-gradient(to bottom right, #f59e0b, #ef4444);
        }
        .card-back {
            background: white;
            transform: rotateY(180deg);
        }
        .card.matched {
            opacity: 0.5;
            transform: scale(0.9);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        #progress-bar {
            margin-top: 1rem; /* mt-4 */
            width: 100%;
            background-color: #e5e7eb; /* bg-gray-200 */
            border-radius: 9999px; /* rounded-full */
            height: 0.625rem; /* h-2.5 */
            display: none;
        }
        #progress-fill {
            background-color: #f97316; /* bg-orange-500 */
            height: 0.625rem;
            border-radius: 9999px;
            transition: all 0.3s; /* transition-all duration-300 */
            width: 0%;
        }
        #message {
            margin-top: 1rem; /* mt-4 */
            font-size: 1.125rem; /* text-lg */
            color: #374151; /* text-gray-700 */
        }
        button {
            padding: 0.5rem 1.5rem; /* px-6 py-2 */
            background-color: #f97316; /* bg-orange-500 */
            color: white;
            border-radius: 0.5rem; /* rounded-lg */
            border: none;
            cursor: pointer;
            transition: background-color 0.2s; /* transition-colors */
            font-weight: 500;
        }
        button:hover {
            background-color: #ea580c; /* hover:bg-orange-600 */
        }
        #restart-btn {
            margin-top: 1rem; /* mt-4 */
        }
        #contrast-toggle {
            margin-top: 0.5rem; /* mt-2 */
            padding: 0.25rem 1rem; /* px-4 py-1 */
            background-color: #e5e7eb; /* bg-gray-200 */
            color: #374151; /* text-gray-700 */
        }
        #contrast-toggle:hover {
            background-color: #d1d5db; /* hover:bg-gray-300 */
        }
        .text-gray-700 {
            color: #374151;
        }
        .text-orange-800 {
            color: #9a3412;
        }
        /* High contrast mode */
        .high-contrast {
            filter: contrast(1.5) brightness(1.2);
        }
        .high-contrast .card-front {
            background: linear-gradient(to bottom right, #000, #fff);
        }
        .high-contrast .card-back {
            background: #000;
            color: #fff;
        }
        .high-contrast body {
            background: linear-gradient(to bottom right, #000, #333);
            color: #fff;
        }
        .high-contrast h1 {
            color: #fff;
        }
        .high-contrast .text-gray-700 {
            color: #fff;
        }
        .high-contrast button {
            background: #fff;
            color: #000;
        }
        .high-contrast #contrast-toggle {
            background: #fff;
            color: #000;
        }
    </style>
</head>
<body>
    <main role="main">
        <section aria-labelledby="game-title">
            <h1 id="game-title" class="text-2xl sm:text-4xl font-bold mb-4 sm:mb-8 text-orange-800">Fruit Memory Game</h1>
            <div class="stats">
                <span class="stat">Moves: <span id="move-count">0</span></span>
                <span class="stat">Time: <span id="timer">00:00</span></span>
                <span class="stat">Best: <span id="best-score">-</span></span>
                <select id="difficulty" aria-label="Select difficulty level">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
            <div id="loading">
                <div class="spinner"></div>
            </div>
            <div class="game-container">
                <div id="game-board" class="grid grid-cols-4 gap-0 justify-items-center place-items-center max-w-64" role="grid" aria-label="Memory game board"></div>
            </div>
            <div id="progress-bar">
                <div id="progress-fill"></div>
            </div>
            <p id="message" aria-live="polite"></p>
            <button id="restart-btn" aria-label="Restart the game">Restart Game</button>
            <button id="contrast-toggle" aria-label="Toggle high contrast mode">Toggle High Contrast</button>
        </section>
    </main>
    <script>
let fruits = ['🍎', '🍌', '🍒', '🍇', '🍋', '🍊', '🍐', '🍓'];
let cards = [...fruits, ...fruits];
cards.sort(() => Math.random() - 0.5);

const difficultyConfigs = {
    easy: { fruits: ['🍎', '🍌', '🍒', '🍇'], gridCols: 'grid-cols-4 gap-0', gap: '0px' },
    medium: { fruits: ['🍎', '🍌', '🍒', '🍇', '🍋', '🍊', '🍐', '🍓'], gridCols: 'grid-cols-4 gap-1', gap: '0.25rem' },
    hard: { fruits: ['🍎', '🍌', '🍒', '🍇', '🍋', '🍊', '🍐', '🍓', '🍉', '🥝', '🥭', '🥥'], gridCols: 'grid-cols-6 gap-1', gap: '0.25rem' } // Adjusted hard to 6 cols for more cards
};

const gameBoard = document.getElementById('game-board');
const message = document.getElementById('message');
const difficultySelect = document.getElementById('difficulty');
const bestScoreEl = document.getElementById('best-score');

let audioContext;
function initAudio() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
}

function playSound(frequency, duration, type = 'sine') {
    initAudio();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    oscillator.frequency.value = frequency;
    oscillator.type = type;
    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + duration);
}

function playFlipSound() {
    playSound(440, 0.1); // Short beep
}

function playMatchSound() {
    playSound(523, 0.2, 'square'); // Higher tone
}

function playWinSound() {
    playSound(659, 0.5, 'triangle'); // Celebratory tone
}

let flippedCards = [];
let matchedCards = [];
let isFlipped = false;
let moves = 0;
let timerInterval = null;
let timeElapsed = 0;

function createCard(fruit, index) {
    const card = document.createElement('div');
    card.className = 'card'; // Now using custom .card CSS
    card.dataset.fruit = fruit;
    card.dataset.index = index;

    const inner = document.createElement('div');
    inner.className = 'card-inner';

    const front = document.createElement('div');
    front.className = 'card-front';
    front.innerHTML = '❓';

    const back = document.createElement('div');
    back.className = 'card-back';
    back.innerHTML = fruit;

    inner.appendChild(front);
    inner.appendChild(back);
    card.appendChild(inner);

    card.addEventListener('click', () => flipCard(card));
    return card;
}

function renderBoard() {
    const loading = document.getElementById('loading');
    const progressBar = document.getElementById('progress-bar');
    loading.style.display = 'flex';
    gameBoard.innerHTML = '';
    cards.forEach((fruit, index) => {
        const card = createCard(fruit, index);
        gameBoard.appendChild(card);
    });
    setTimeout(() => {
        loading.style.display = 'none';
        progressBar.style.display = 'block';
        updateProgress();
    }, 500);
}

function flipCard(card) {
    if (flippedCards.length < 2 && !flippedCards.includes(card) && !matchedCards.includes(card) && !isFlipped) {
        moves++;
        document.getElementById('move-count').textContent = moves;
        playFlipSound();
        card.classList.add('flipped');
        flippedCards.push(card);

        if (flippedCards.length === 1 && !timerInterval) {
            startTimer();
        }

        if (flippedCards.length === 2) {
            isFlipped = true;
            setTimeout(() => {
                const [card1, card2] = flippedCards;
                if (card1.dataset.fruit === card2.dataset.fruit) {
                    playMatchSound();
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedCards.push(card1, card2);
                    updateProgress();
                    if (matchedCards.length === cards.length) {
                        message.textContent = 'You won! 🎉';
                        clearInterval(timerInterval);
                        playWinSound();

                        // Calculate and save score
                        const score = moves + timeElapsed;
                        const difficulty = difficultySelect.value;
                        const storedScore = localStorage.getItem(`bestScore_${difficulty}`);
                        if (!storedScore || score < parseInt(storedScore)) {
                            localStorage.setItem(`bestScore_${difficulty}`, score.toString());
                            updateBestScore(score, difficulty);
                        }

                        // Removed confetti call for offline compatibility
                    }
                } else {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                }
                flippedCards = [];
                isFlipped = false;
            }, 1000);
        }
    }
}

function startTimer() {
    timerInterval = setInterval(() => {
        timeElapsed++;
        updateTimer();
    }, 1000);
}

function updateTimer() {
    const minutes = Math.floor(timeElapsed / 60);
    const seconds = timeElapsed % 60;
    document.getElementById('timer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function updateProgress() {
    const totalPairs = cards.length / 2;
    const matchedPairs = matchedCards.length / 2;
    const progress = (matchedPairs / totalPairs) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
}

function resetGame() {
    moves = 0;
    timeElapsed = 0;
    flippedCards = [];
    matchedCards = [];
    isFlipped = false;
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
    document.getElementById('move-count').textContent = moves;
    document.getElementById('timer').textContent = '00:00';
    message.textContent = '';

    // Remove flipped and matched classes from all cards
    document.querySelectorAll('.card').forEach(card => {
        card.classList.remove('flipped', 'matched');
    });

    const selectedDifficulty = difficultySelect.value;
    const config = difficultyConfigs[selectedDifficulty];
    fruits = config.fruits;
    cards = [...fruits, ...fruits];
    cards.sort(() => Math.random() - 0.5);

    // Update grid classes for difficulty
    gameBoard.className = `grid ${config.gridCols} justify-items-center place-items-center max-w-64`;
    gameBoard.style.gap = config.gap; // Set gap dynamically

    renderBoard();
    loadBestScore();
    updateProgress();
}

function updateBestScore(score, difficulty) {
    const storedScore = localStorage.getItem(`bestScore_${difficulty}`);
    bestScoreEl.textContent = storedScore ? storedScore : '-';
}

function loadBestScore() {
    const difficulty = difficultySelect.value;
    updateBestScore(null, difficulty);
}

document.getElementById('restart-btn').addEventListener('click', resetGame);

difficultySelect.addEventListener('change', resetGame);

initAudio();

loadBestScore();

document.getElementById('contrast-toggle').addEventListener('click', () => {
    document.body.classList.toggle('high-contrast');
});

renderBoard();
    </script>
</body>
</html>